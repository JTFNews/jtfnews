<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JTF News - Just The Facts</title>

    <!-- Favicon - adapts to light/dark mode -->
    <link rel="icon" type="image/png" sizes="32x32" href="assets/png/icon-square-32.png" media="(prefers-color-scheme: light)">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/png/icon-square-dark-32.png" media="(prefers-color-scheme: dark)">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/png/icon-square-16.png" media="(prefers-color-scheme: light)">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/png/icon-square-dark-16.png" media="(prefers-color-scheme: dark)">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/png/icon-square-dark-256.png">
    <link rel="icon" type="image/svg+xml" href="assets/icon-square.svg" media="(prefers-color-scheme: light)">
    <link rel="icon" type="image/svg+xml" href="assets/icon-square-dark.svg" media="(prefers-color-scheme: dark)">

    <!-- SEO Meta Tags -->
    <meta name="description" content="24/7 automated news reporting only verified facts. No opinions, no adjectives, no interpretation. Every fact confirmed by 2+ independent sources.">
    <meta name="keywords" content="unbiased news, facts only news, news without opinion, verified news, fact-based reporting, no commentary news">
    <meta name="author" content="JTF News">
    <link rel="canonical" href="https://jtfnews.org/">

    <!-- OpenGraph Tags -->
    <meta property="og:title" content="JTF News - Just The Facts">
    <meta property="og:description" content="24/7 automated news reporting only verified facts. No opinions, no adjectives, no interpretation.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://jtfnews.org/">
    <meta property="og:site_name" content="JTF News">
    <meta property="og:image" content="https://jtfnews.org/assets/png/banner-twitter-1500x500.png">
    <meta property="og:image:width" content="1500">
    <meta property="og:image:height" content="500">

    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="JTF News - Just The Facts">
    <meta name="twitter:description" content="24/7 automated news reporting only verified facts. No opinions, no adjectives, no interpretation.">
    <meta name="twitter:image" content="https://jtfnews.org/assets/png/banner-twitter-1500x500.png">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Shared Stylesheet -->
    <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- Navigation -->
<nav class="site-nav" role="navigation" aria-label="Main navigation">
    <div class="site-nav__inner">
        <a href="index.html" class="site-nav__logo">
            <img src="assets/logo-horizontal-dark.svg" alt="JTF News">
        </a>
        <ul class="site-nav__links">
            <li><a href="index.html" aria-current="page">Home</a></li>
            <li><a href="how-it-works.html">How It Works</a></li>
            <li><a href="sources.html">Sources</a></li>
            <li><a href="whitepaper.html">Whitepaper</a></li>
            <li><a href="archive.html">Archive</a></li>
            <li><a href="corrections.html">Corrections</a></li>
        </ul>
        <button class="site-nav__toggle" aria-label="Open menu" onclick="document.getElementById('nav-overlay').classList.add('open')">
            <span></span><span></span><span></span>
        </button>
    </div>
</nav>
<div id="nav-overlay" class="site-nav__overlay">
    <button class="site-nav__close" aria-label="Close menu" onclick="this.parentElement.classList.remove('open')">&times;</button>
    <a href="index.html">Home</a>
    <a href="how-it-works.html">How It Works</a>
    <a href="sources.html">Sources</a>
    <a href="whitepaper.html">Whitepaper</a>
    <a href="archive.html">Archive</a>
    <a href="corrections.html">Corrections</a>
</div>

<!-- Hero -->
<section class="hero">
    <div class="container">
        <h1 class="hero__title">Just The Facts.</h1>
        <p class="hero__subtitle">No opinions. No adjectives. No interpretation.</p>
        <p class="hero__desc">24/7 verified news from 17 independent sources.</p>
        <div class="hero__actions">
            <a href="https://www.youtube.com/@JTFNewsLive" class="btn btn--secondary">Watch Live</a>
            <a href="how-it-works.html" class="btn btn--outline">How It Works</a>
        </div>
    </div>
</section>

<!-- Live Story Preview -->
<section class="container">
    <div class="live-preview">
        <div class="live-preview__badge" id="demo-label">Live Story</div>
        <div class="live-preview__card">
            <div class="live-preview__sources" id="demo-sources">Loading...</div>
            <div class="live-preview__fact" id="demo-fact">Loading latest verified fact...</div>
        </div>
    </div>
</section>

<!-- How It Works -->
<section class="container section">
    <h2 class="section__title">How It Works</h2>
    <div class="card-grid">
        <div class="card"><h3>1. Collect</h3><p>Headlines gathered from 17+ sources worldwide, including public broadcasters and government records.</p></div>
        <div class="card"><h3>2. Extract</h3><p>AI extracts only verifiable facts. Opinions, adjectives, and speculation are removed.</p></div>
        <div class="card"><h3>3. Verify</h3><p>Facts require 2+ independent sources with different owners before broadcast.</p></div>
        <div class="card"><h3>4. Broadcast</h3><p>Verified facts are spoken aloud and displayed with full source attribution.</p></div>
    </div>
    <p class="text-center"><a href="how-it-works.html">Learn more about our process &rarr;</a></p>
</section>

<!-- Operational Costs -->
<section class="container section">
    <h2 class="section__title">Operational Costs</h2>
    <div class="costs-section">
        <div class="costs-header">
            <h3>Operational Costs (Live)</h3>
            <span class="live-badge" id="live-status">Loading...</span>
        </div>
        <div class="costs-grid">
            <div class="cost-item">
                <div class="cost-label">Today's Cost</div>
                <div class="cost-value highlight" id="today-cost">--</div>
                <div class="cost-detail" id="today-calls">-- API calls</div>
                <div class="budget-bar">
                    <div class="budget-fill green" id="budget-fill" style="width: 0%"></div>
                </div>
                <div class="cost-detail" id="budget-text">-- of $5 budget</div>
            </div>
            <div class="cost-item">
                <div class="cost-label">Monthly Estimate</div>
                <div class="cost-value" id="month-estimate">--</div>
                <div class="cost-detail">projected at current rate</div>
            </div>
        </div>
        <div class="costs-breakdown">
            <div class="breakdown-row">
                <span class="breakdown-service">Claude AI (fact extraction)</span>
                <span class="breakdown-cost" id="claude-cost">--</span>
            </div>
            <div class="breakdown-row">
                <span class="breakdown-service">ElevenLabs (voice)</span>
                <span class="breakdown-cost" id="elevenlabs-cost">--</span>
            </div>
            <div class="breakdown-row">
                <span class="breakdown-service">Twilio (alerts)</span>
                <span class="breakdown-cost" id="twilio-cost">--</span>
            </div>
        </div>
        <div class="status-row">
            <span class="status-dot" id="status-dot"></span>
            <span class="status-text" id="status-text">Checking status...</span>
        </div>
        <p class="transparency-note">
            Full transparency: Every API call is tracked and reported in real-time.
        </p>
        <a class="dashboard-link" href="monitor.html">View Full Operations Dashboard &rarr;</a>
    </div>
</section>

<!-- Get Involved -->
<section class="container section">
    <h2 class="section__title">Get Involved</h2>
    <div class="card-grid">
        <div class="card text-center">
            <h3>Podcast</h3>
            <p>Daily digest with full show notes.</p>
            <a href="podcast.xml" class="btn btn--secondary" style="display:inline-block;margin-top:0.75rem;">Subscribe</a>
        </div>
        <div class="card text-center">
            <h3>RSS Feed</h3>
            <p>Subscribe to verified facts.</p>
            <a href="feed.xml" class="btn btn--secondary" style="display:inline-block;margin-top:0.75rem;">Subscribe</a>
        </div>
        <div class="card text-center">
            <h3>Watch Live</h3>
            <p>24/7 on YouTube.</p>
            <a href="https://www.youtube.com/@JTFNewsLive" class="btn btn--secondary" style="display:inline-block;margin-top:0.75rem;">YouTube</a>
        </div>
        <div class="card text-center">
            <h3>Support</h3>
            <p>No ads. No tracking. Viewer-supported.</p>
            <a href="https://github.com/sponsors/larryseyer" class="btn btn--primary" style="display:inline-block;margin-top:0.75rem;">Sponsor</a>
        </div>
    </div>
</section>

<!-- Footer -->
<footer class="site-footer">
    <div class="site-footer__inner">
        <ul class="site-footer__links">
            <li><a href="index.html">Home</a></li>
            <li><a href="how-it-works.html">How It Works</a></li>
            <li><a href="sources.html">Sources</a></li>
            <li><a href="whitepaper.html">Whitepaper</a></li>
            <li><a href="archive.html">Archive</a></li>
            <li><a href="corrections.html">Corrections</a></li>
            <li><a href="monitor.html">Dashboard</a></li>
            <li><a href="feed.xml">RSS</a></li>
            <li><a href="podcast.xml">Podcast</a></li>
        </ul>
        <p class="site-footer__tagline">The methodology belongs to no one. It serves everyone.</p>
        <p class="site-footer__copy">
            <a href="https://github.com/JTFNews/jtfnews">GitHub</a> &middot;
            <a href="https://github.com/sponsors/larryseyer">Support</a>
        </p>
    </div>
</footer>

<script>
    // Cycle-sync refresh state
    let lastKnownRefreshAt = null;

    function formatCurrency(amount) {
        if (typeof amount !== 'number') return '$0.00';
        return '$' + amount.toFixed(2);
    }

    function formatUptime(seconds) {
        if (!seconds) return '--';
        const hours = Math.floor(seconds / 3600);
        const minutes = Math.floor((seconds % 3600) / 60);
        if (hours > 0) return hours + 'h ' + minutes + 'm uptime';
        return minutes + 'm uptime';
    }

    function checkForCycleRefresh(data) {
        const currentRefreshAt = data.web_refresh_at;
        if (!currentRefreshAt) return;

        if (lastKnownRefreshAt === null) {
            lastKnownRefreshAt = currentRefreshAt;
            console.log('[Cycle Refresh] Initial timestamp:', currentRefreshAt);
            return;
        }

        if (currentRefreshAt !== lastKnownRefreshAt) {
            console.log('[Cycle Refresh] New cycle detected, refreshing...');
            location.reload();
        }
    }

    async function loadCosts() {
        try {
            const response = await fetch('./monitor.json?t=' + Date.now());
            if (!response.ok) throw new Error('Not found');
            const data = await response.json();

            // Check for cycle-sync refresh
            checkForCycleRefresh(data);

            // Check if data is stale (>15 min old)
            const dataTime = new Date(data.timestamp);
            const now = new Date();
            const isStale = (now - dataTime) > 15 * 60 * 1000;

            // Update live badge
            const liveBadge = document.getElementById('live-status');
            if (isStale) {
                liveBadge.textContent = 'Stale';
                liveBadge.style.background = 'rgba(234, 179, 8, 0.2)';
                liveBadge.style.color = '#eab308';
            } else {
                liveBadge.textContent = 'Live';
                liveBadge.style.background = 'rgba(34, 197, 94, 0.2)';
                liveBadge.style.color = '#22c55e';
            }

            // Update costs
            const costs = data.api_costs || {};
            const services = costs.today || {};

            document.getElementById('today-cost').textContent = formatCurrency(costs.total_usd);
            document.getElementById('month-estimate').textContent = formatCurrency(costs.month_estimate_usd);

            // Update budget bar
            const budgetPct = costs.budget_pct || 0;
            const dailyBudget = costs.daily_budget || 5;
            const budgetFill = document.getElementById('budget-fill');
            const budgetText = document.getElementById('budget-text');

            budgetFill.style.width = Math.min(budgetPct, 100) + '%';
            budgetFill.className = 'budget-fill ' + (budgetPct < 50 ? 'green' : budgetPct < 80 ? 'yellow' : 'red');
            budgetText.textContent = budgetPct.toFixed(0) + '% of $' + dailyBudget + ' daily budget';

            // Count total calls
            let totalCalls = 0;
            for (const svc of Object.values(services)) {
                totalCalls += svc.calls || 0;
            }
            document.getElementById('today-calls').textContent = totalCalls + ' API calls';

            // Service breakdown
            const claude = services.claude || {};
            const elevenlabs = services.elevenlabs || {};
            const twilio = services.twilio || {};

            document.getElementById('claude-cost').textContent = formatCurrency(claude.cost_usd);
            document.getElementById('elevenlabs-cost').textContent = formatCurrency(elevenlabs.cost_usd);
            document.getElementById('twilio-cost').textContent = formatCurrency(twilio.cost_usd);

            // Status
            const statusDot = document.getElementById('status-dot');
            const statusText = document.getElementById('status-text');
            const streamHealth = data.status?.stream_health || 'unknown';

            if (streamHealth === 'online') {
                statusDot.className = 'status-dot';
                statusText.textContent = 'Stream online \u2022 ' + formatUptime(data.uptime_seconds);
            } else if (streamHealth === 'offline') {
                statusDot.className = 'status-dot offline';
                statusText.textContent = 'Stream offline';
            } else {
                statusDot.className = 'status-dot';
                statusDot.style.background = '#64748b';
                statusText.textContent = 'Status unknown';
            }

        } catch (e) {
            document.getElementById('live-status').textContent = 'Offline';
            document.getElementById('live-status').style.background = 'rgba(239, 68, 68, 0.2)';
            document.getElementById('live-status').style.color = '#ef4444';
            document.getElementById('status-text').textContent = 'Could not load live data';
        }
    }

    // Load immediately and refresh every 30 seconds
    loadCosts();
    setInterval(loadCosts, 30000);

    // Live story preview
    async function loadLivePreview() {
        try {
            const response = await fetch('./stories.json?t=' + Date.now());
            if (!response.ok) throw new Error('No stories');
            const data = await response.json();
            if (!data.stories || data.stories.length === 0) throw new Error('Empty');
            const story = data.stories[0];
            document.getElementById('demo-sources').textContent = story.source || 'JTF News';
            document.getElementById('demo-fact').textContent = story.fact;
            document.getElementById('demo-label').innerHTML = 'Live Story <span style="background:rgba(34,197,94,0.2);color:#22c55e;padding:2px 8px;border-radius:10px;font-size:9px;margin-left:8px;">LIVE</span>';
        } catch (e) {
            document.getElementById('demo-sources').textContent = 'Reuters 9.8|9.5 \u00b7 AP 9.6|9.4';
            document.getElementById('demo-fact').textContent = 'The European Central Bank held interest rates at 2.75% at its February 2025 meeting.';
            document.getElementById('demo-label').textContent = 'Example';
        }
    }
    loadLivePreview();
</script>
</body>
</html>
